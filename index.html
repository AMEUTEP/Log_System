
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Attachment Upload Demo</title>
  <style>
    table, th, td { border: 1px solid #ccc; border-collapse: collapse; padding: 8px; }
    th { background: #00205B; color: white; }
    .upload-btn { background: #FF8200; color: white; border: none; padding: 6px 12px; cursor: pointer; }
  </style>
</head>
<body>
  <h1>ðŸ“¦ Package Log - Upload Test</h1>
  <table id="logTable">
    <thead>
      <tr>
        <th>Receipt</th><th>Entered By</th><th>Attachment</th>
      </tr>
    </thead>
    <tbody id="logBody"></tbody>
  </table>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
  import { getFirestore, collection, getDocs, updateDoc, doc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
  import { getStorage, ref, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-storage.js";

  const firebaseConfig = {
    apiKey: "AIzaSyCy8r9QFTE9d4ayBrCPj6-MRvoeVFZJgyc",
    authDomain: "packagelog-8a672.firebaseapp.com",
    projectId: "packagelog-8a672",
    storageBucket: "packagelog-8a672.appspot.com",
    messagingSenderId: "424373386333",
    appId: "1:424373386333:web:9827c71cafb9829d0fa1b4",
    measurementId: "G-12P37M2SKV"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);
  const storage = getStorage(app);

  const entriesRef = collection(db, "entries");
  const logBody = document.getElementById("logBody");

  async function loadEntries() {
    const snapshot = await getDocs(entriesRef);
    snapshot.forEach(docSnap => {
      const entry = docSnap.data();
      const id = docSnap.id;
      const row = document.createElement("tr");
      row.innerHTML = `
        <td>${entry.receiptNumber || ""}</td>
        <td>${entry.enteredBy || ""}</td>
        <td>
          <button class="upload-btn" onclick="uploadAttachment('${id}')">Upload</button>
          <span id="link-${id}">${entry.attachmentURL ? `<a href='${entry.attachmentURL}' target='_blank'>View</a>` : ""}</span>
        </td>
      `;
      logBody.appendChild(row);
    });
  }

  window.uploadAttachment = async (entryId) => {
    const fileInput = document.createElement("input");
    fileInput.type = "file";
    fileInput.onchange = async () => {
      const file = fileInput.files[0];
      const fileRef = ref(storage, `attachments/${entryId}/${file.name}`);
      await uploadBytes(fileRef, file);
      const downloadURL = await getDownloadURL(fileRef);
      await updateDoc(doc(db, "entries", entryId), { attachmentURL: downloadURL });
      document.getElementById(`link-${entryId}`).innerHTML = `<a href='${downloadURL}' target='_blank'>View</a>`;
    };
    fileInput.click();
  };

  loadEntries();
</script>
</body>
</html>
