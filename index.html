
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Package Pickup Log</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    #app, #poSection, #dataChecklist, #ameQuestion { display: none; }
    fieldset { margin-bottom: 20px; padding: 10px; }
    table { border-collapse: collapse; width: 100%; margin-top: 20px; }
    th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }
    th { background-color: #f4f4f4; }
  </style>
</head>
<body>

<!-- ...[TRUNCATED HEAD + FORM CONTENT for brevity here; same as before] -->

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
  import { getFirestore, collection, addDoc, getDocs } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyCy8r9QFTE9d4ayBrCPj6-MRvoeVFZJgyc",
    authDomain: "packagelog-8a672.firebaseapp.com",
    projectId: "packagelog-8a672",
    storageBucket: "packagelog-8a672.appspot.com",
    messagingSenderId: "424373386333",
    appId: "1:424373386333:web:9827c71cafb9829d0fa1b4",
    measurementId: "G-12P37M2SKV"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);
  window.firebaseDB = db;

  const form = document.getElementById("pickupForm");
  const tableBody = document.querySelector("#logTable tbody");
  let savedReceipts = [];

  function toggleChecklist(show) {
    document.getElementById("dataChecklist").style.display = show ? "block" : "none";
  }

  function checkPasscode() {
    const input = document.getElementById("passcodeInput").value;
    if (input === "LevoskyUTEPA129!") {
      document.getElementById("loginScreen").style.display = "none";
      document.getElementById("app").style.display = "block";
      document.getElementById("ameQuestion").style.display = "block";
      loadEntries();
    } else {
      document.getElementById("loginError").innerText = "Incorrect passcode.";
    }
  }

  window.addEventListener("keydown", function (e) {
    if (e.key === "Enter" && document.getElementById("loginScreen").style.display !== "none") {
      e.preventDefault();
      checkPasscode();
    }
  });

  async function loadEntries() {
    const db = window.firebaseDB;
    tableBody.innerHTML = "";
    savedReceipts = [];
    const querySnapshot = await getDocs(collection(db, "entries"));
    querySnapshot.forEach((doc) => {
      const entry = doc.data();
      savedReceipts.push(entry.receiptNumber + (entry.poNumber || ""));
      const row = tableBody.insertRow();
      row.insertCell(0).innerText = entry.pickupName || '';
      row.insertCell(1).innerText = entry.pickupDate || '';
      row.insertCell(2).innerText = entry.sharepoint || '';
      row.insertCell(3).innerText = entry.minermall || '';
      row.insertCell(4).innerText = entry.enteredBy || '';
    });
  }

  form.addEventListener("submit", async (e) => {
    e.preventDefault();
    const db = window.firebaseDB;
    const receipt = document.getElementById("receiptNumber").value;
    const po = document.getElementById("poNumber").value;
    const combinedKey = receipt + po;

    if (savedReceipts.includes(combinedKey) || savedReceipts.includes(receipt)) {
      if (!po) {
        document.getElementById("poSection").style.display = "block";
        alert("Duplicate Receipt Number detected. Please enter PO Number.");
        return;
      }
    }

    const entry = {
      receiptNumber: receipt,
      poNumber: po,
      pickupName: document.getElementById("pickupName").value,
      pickupDate: document.getElementById("pickupDate").value,
      sharepoint: document.getElementById("sharepoint").checked ? "Yes" : "No",
      minermall: document.getElementById("minermall").checked ? "Yes" : "No",
      enteredBy: document.getElementById("enteredBy").value
    };

    try {
      await addDoc(collection(db, "entries"), entry);
      alert("Entry saved to Firebase!");
      form.reset();
      document.getElementById("poSection").style.display = "none";
      loadEntries();
    } catch (error) {
      console.error("Error saving entry:", error);
      alert("Error saving entry: " + error.message);
    }
  });
</script>
</body>
</html>
